<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nilai Mutlak - Versi Acak (Responsif)</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --dark-bg: #141414; --dark-card: #1f1f1f; --dark-border: #333;
            --text-light: #f0f0f0; --text-muted: #aaa; --accent-blue: #007bff;
            --accent-green: #28a745; --accent-red: #dc3545; --accent-yellow: #ffc107;
            --accent-teal: #50e3c2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--dark-bg); color: var(--text-light);
            min-height: 100vh; padding: 20px;
        }
        .container {
            max-width: 900px; margin: 0 auto; background: var(--dark-card);
            border-radius: 15px; padding: 30px; border: 1px solid var(--dark-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .header {
            text-align: center; margin-bottom: 30px; padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-blue);
        }
        .header h1 { color: var(--text-light); font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: var(--text-muted); font-size: 1.1em; }
        .progress-container {
            margin: 30px 0; padding: 20px; background: rgba(0,0,0,0.2);
            border: 1px solid var(--dark-border); border-radius: 15px;
        }
        .progress-steps {
            display: flex; justify-content: space-between; margin-bottom: 15px; position: relative;
        }
        .progress-steps::before {
            content: ''; position: absolute; top: 20px; left: 0; right: 0;
            height: 4px; background: var(--dark-border); z-index: 0;
        }
        .progress-fill {
            position: absolute; top: 20px; left: 0; height: 4px;
            background: var(--accent-blue); transition: width 0.5s ease; z-index: 1;
        }
        .step { display: flex; flex-direction: column; align-items: center; z-index: 2; position: relative; }
        .step-circle {
            width: 40px; height: 40px; border-radius: 50%; background: var(--dark-border);
            display: flex; align-items: center; justify-content: center; font-weight: bold;
            color: var(--text-muted); border: 3px solid var(--dark-border); margin-bottom: 8px; transition: all 0.3s;
        }
        .step.active .step-circle {
            background: var(--dark-card); border-color: var(--accent-blue);
            color: var(--accent-blue); transform: scale(1.2);
        }
        .step.completed .step-circle { background: var(--accent-green); border-color: var(--accent-green); color: white; }
        .step-label { font-size: 0.85em; color: var(--text-muted); font-weight: 600; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
        .stat-card {
            background: var(--dark-bg); border: 1px solid var(--dark-border);
            padding: 15px; border-radius: 12px; text-align: center;
        }
        .stat-value { font-size: 2em; font-weight: bold; color: var(--accent-teal); margin-bottom: 5px; }
        .stat-label { font-size: 0.9em; color: var(--text-muted); }
        .content-area { margin: 30px 0; min-height: 300px; }
        .material-section, .question-card, .result-summary {
            padding: 25px; background: var(--dark-card); border: 1px solid var(--dark-border);
            border-radius: 15px; margin-bottom: 20px;
        }
        .question-number { color: var(--accent-blue); font-weight: bold; margin-bottom: 15px; }
        .question-text { margin-bottom: 20px; font-size: 1.1em; }
        .option {
            padding: 15px 20px; background: var(--dark-bg); border: 2px solid var(--dark-border);
            border-radius: 10px; cursor: pointer; transition: all 0.3s; display: flex;
            align-items: center; color: var(--text-muted);
        }
        .option:hover { border-color: var(--accent-blue); color: var(--text-light); background: #2a2a2a; }
        .option.selected { border-color: var(--accent-blue); background: rgba(0, 123, 255, 0.1); color: var(--text-light); }
        .option.correct { border-color: var(--accent-green); background: rgba(40, 167, 69, 0.2); color: #d4edda; }
        .option.incorrect { border-color: var(--accent-red); background: rgba(220, 53, 69, 0.2); color: #f8d7da; }
        .option input[type="radio"] { margin-right: 15px; }
        .btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-muted); padding: 12px 35px; border-radius: 8px; font-size: 1em;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 10px 5px;
        }
        .btn:hover { background: rgba(255, 255, 255, 0.1); color: var(--text-light); transform: translateY(-2px); }
        .btn-primary { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }
        .btn-primary:hover { background: #0069d9; border-color: #0062cc; }
        .btn-secondary { background: #6c757d; border-color: #6c757d; color: white; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; background: var(--dark-border); }
        .button-group { display: flex; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        .explanation {
            background: #2a2a2a; padding: 15px; border-radius: 10px; margin-top: 20px;
            border: 1px solid #444; color: var(--text-muted);
        }
        .attempts-info {
            background-color: rgba(255, 193, 7, 0.1); border-left: 5px solid var(--accent-yellow);
            color: #fff3cd; padding: 15px; border-radius: 10px; margin: 15px 0;
        }
        .hidden { display: none; }
        .certificate {
            background: linear-gradient(135deg, #1f1f1f, #2a2a2a); color: white; padding: 40px;
            border-radius: 20px; text-align: center; margin: 30px 0; border: 2px solid var(--accent-teal);
            box-shadow: 0 0 40px rgba(80, 227, 194, 0.2);
        }
        #notification-container {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            display: flex; flex-direction: column; gap: 10px;
        }
        .notification {
            background-color: #2a2a2a; color: var(--text-light); padding: 15px 20px;
            border-radius: 8px; border-left: 5px solid; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 10px;
            animation: slideIn 0.3s ease forwards, fadeOut 0.5s ease 3.5s forwards;
        }
        .notification.warning { border-color: var(--accent-yellow); }
        .notification.success { border-color: var(--accent-green); }
        .notification.info { border-color: var(--accent-blue); }
        @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: translateY(20px); } }
        .material-title { color: var(--text-light); font-size: 2em; margin-bottom: 10px; }
        .material-intro { color: var(--text-muted); font-size: 1.1em; margin-bottom: 30px; }
        .material-point { margin-bottom: 35px; }
        .material-heading {
            color: var(--accent-teal); font-size: 1.5em; margin-bottom: 15px;
            padding-bottom: 10px; border-bottom: 1px solid var(--dark-border);
            display: flex; align-items: center;
        }
        .material-heading::before {
            content: '»'; margin-right: 12px; color: var(--accent-blue);
            font-weight: bold; font-size: 1.2em;
        }
        .key-concept { color: var(--accent-yellow); font-weight: 600; }
        .rule-box {
            background-color: rgba(0,0,0,0.2); border-left: 4px solid var(--accent-blue);
            padding: 20px; margin-top: 15px; border-radius: 0 8px 8px 0; line-height: 1.8;
        }
        .rule-box ul { list-style-type: none; padding-left: 0; }
        .rule-box li { margin-bottom: 15px; }
        
        /* --- PERBAIKAN TAMPILAN MOBILE (RESPONSIF) --- */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px 15px;
            }
            .header h1 {
                font-size: 2em;
            }
            .material-title {
                font-size: 1.8em;
            }

            /* 1. Perbaikan Progress Bar */
            .step-label {
                display: none; /* Sembunyikan label di layar kecil */
            }
            .step-circle {
                width: 35px;
                height: 35px;
            }
            .progress-steps::before, .progress-fill {
                top: 17.5px; /* Sesuaikan posisi garis */
            }

            /* 2. Perbaikan Kartu Statistik */
            .stats {
                grid-template-columns: 1fr; /* Susun kartu menjadi 1 kolom */
                gap: 10px;
            }

            /* 3. Penyesuaian Tombol */
            .button-group {
                flex-direction: column; /* Susun tombol ke bawah */
                align-items: stretch;
            }
            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚡ Nilai Mutlak</h1>
            <p>Sistem Pembelajaran Terstruktur dengan 3 Level</p>
        </div>
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                <div class="step" id="step0"><div class="step-circle">📚</div><div class="step-label">Materi</div></div>
                <div class="step" id="step1"><div class="step-circle">1</div><div class="step-label">LOTS</div></div>
                <div class="step" id="step2"><div class="step-circle">2</div><div class="step-label">MOTS</div></div>
                <div class="step" id="step3"><div class="step-circle">3</div><div class="step-label">HOTS</div></div>
                <div class="step" id="step4"><div class="step-circle">🏆</div><div class="step-label">Selesai</div></div>
            </div>
            <div class="stats">
                <div class="stat-card"><div class="stat-value" id="currentLevel">Materi</div><div class="stat-label">Level Saat Ini</div></div>
                <div class="stat-card"><div class="stat-value" id="attemptsLeft">5</div><div class="stat-label">Percobaan Tersisa</div></div>
                <div class="stat-card"><div class="stat-value" id="passCount">0/2</div><div class="stat-label">Kali Lulus</div></div>
            </div>
        </div>
        <div class="content-area" id="contentArea"></div>
    </div>

    <div id="notification-container"></div>
    
    <script>
      if (!sessionStorage.getItem('sessionToken')) {
            window.location.href = '../../Login/';
        }
        // --- SELURUH KODE JAVASCRIPT DAN BANK SOAL TETAP SAMA SEPERTI SEBELUMNYA ---
        const state = { currentStage: 0, attempts: { LOTS: 5, MOTS: 5, HOTS: 5 }, passCount: { LOTS: 0, MOTS: 0, HOTS: 0 }, consecutiveFails: { LOTS: 0, MOTS: 0, HOTS: 0 }, currentQuiz: null, userAnswers: [], activeQuestions: [] };
        const quizContent = {
            material: `<h2 class="material-title">📚 Materi Ringkas: Nilai Mutlak</h2><p class="material-intro">Selamat datang! Topik kali ini adalah Nilai Mutlak. Pahami konsep dasarnya sebelum memulai latihan.</p><div class="material-point"><h3 class="material-heading">1. Definisi Nilai Mutlak</h3><p>Nilai mutlak dari suatu bilangan adalah <strong class="key-concept">jarak</strong> bilangan tersebut dari angka nol (0) pada garis bilangan, tanpa memperhatikan arahnya. Karena merupakan jarak, nilainya selalu positif atau nol.</p><div class="rule-box"><strong>Notasi dan Sifat:</strong><br>\\(|x| = \\begin{cases} x, & \\text{jika } x \\ge 0 \\\\ -x, & \\text{jika } x < 0 \\end{cases} \\)<br>Contoh: \\(|7| = 7\\) dan \\(|-7| = -(-7) = 7\\)</div></div><div class="material-point"><h3 class="material-heading">2. Persamaan & Pertidaksamaan</h3><p>Berikut adalah aturan dasar penyelesaian (untuk konstanta \\(c > 0\\)):</p><div class="rule-box"><ul><li><strong>Persamaan:</strong><br>Jika \\(|f(x)| = c\\), maka solusinya adalah \\(f(x) = c\\) atau \\(f(x) = -c\\).</li><li><strong>Pertidaksamaan "Kurang Dari":</strong><br>Jika \\(|f(x)| < c\\), maka solusinya adalah \\(-c < f(x) < c\\).</li><li><strong>Pertidaksamaan "Lebih Dari":</strong><br>Jika \\(|f(x)| > c\\), maka solusinya adalah \\(f(x) < -c\\) atau \\(f(x) > c\\).</li></ul></div></div><div class="attempts-info" style="margin-top: 20px;"><strong>⚠️ Peraturan:</strong> Setiap percobaan terdiri dari <strong>5 soal acak</strong>. Lulus level jika skor ≥ 80% (benar 4 dari 5 soal). Anda harus lulus 2 kali untuk membuka level selanjutnya.</div>`,
            LOTS: [
                { question: "Nilai dari \\(|-100|\\) adalah...", options: [{ text: "100" }, { text: "-100" }, { text: "0" }], correct: 0, explanation: "Nilai mutlak adalah jarak dari nol, yang selalu non-negatif. Jarak -100 dari 0 adalah 100." },
                { question: "Nilai dari \\(|53|\\) adalah...", options: [{ text: "53" }, { text: "-53" }, { text: "1/53" }], correct: 0, explanation: "Nilai mutlak dari bilangan positif adalah bilangan itu sendiri." },
                { question: "Bentuk \\(|-15|\\) sama nilainya dengan...", options: [{ text: "\\(|15|\\)" }, { text: "-15" }, { text: "1/15" }], correct: 0, explanation: "\\(|-15| = 15\\) dan \\(|15| = 15\\). Keduanya sama." },
                { question: "Manakah pernyataan yang SALAH?", options: [{ text: "\\(|-5| = -5\\)" }, { text: "\\(|-5| = 5\\)" }, { text: "\\(|5| = 5\\)" }], correct: 0, explanation: "Nilai mutlak tidak pernah bernilai negatif. Pernyataan \\(|-5| = -5\\) adalah salah." },
                { question: "Jarak antara titik -8 dan 0 pada garis bilangan adalah...", options: [{ text: "8" }, { text: "-8" }, { text: "0" }], correct: 0, explanation: "Jarak direpresentasikan oleh nilai mutlak. Jaraknya adalah \\(|-8| = 8\\)." },
                { question: "Hasil dari \\(|25 - 10|\\) adalah...", options: [{ text: "15" }, { text: "-15" }, { text: "35" }], correct: 0, explanation: "Hitung di dalam tanda mutlak dulu: \\(25 - 10 = 15\\). Lalu, \\(|15| = 15\\)." },
                { question: "Hasil dari \\(|9 - 17|\\) adalah...", options: [{ text: "8" }, { text: "-8" }, { text: "26" }], correct: 0, explanation: "Hitung di dalam tanda mutlak dulu: \\(9 - 17 = -8\\). Lalu, \\(|-8| = 8\\)." },
                { question: "Hasil dari \\(|-5 \\times 6|\\) adalah...", options: [{ text: "30" }, { text: "-30" }, { text: "1" }], correct: 0, explanation: "Hitung di dalam tanda mutlak dulu: \\(-5 \\times 6 = -30\\). Lalu, \\(|-30| = 30\\)." },
                { question: "Hasil dari \\(|40 \\div -5|\\) adalah...", options: [{ text: "8" }, { text: "-8" }, { text: "35" }], correct: 0, explanation: "Hitung di dalam tanda mutlak dulu: \\(40 \\div -5 = -8\\). Lalu, \\(|-8| = 8\\)." },
                { question: "Hasil dari \\(|2 - 3 \\times 4|\\) adalah...", options: [{ text: "10" }, { text: "-10" }, { text: "4" }], correct: 0, explanation: "Kerjakan perkalian dulu: \\(3 \\times 4 = 12\\). Lalu \\(2 - 12 = -10\\). Maka, \\(|-10| = 10\\)." },
                { question: "Nilai dari \\(|-20| + |10|\\) adalah...", options: [{ text: "30" }, { text: "10" }, { text: "-10" }], correct: 0, explanation: "\\(|-20| = 20\\) dan \\(|10| = 10\\). Jadi, \\(20 + 10 = 30\\)." },
                { question: "Nilai dari \\(|15| - |-5|\\) adalah...", options: [{ text: "10" }, { text: "20" }, { text: "-10" }], correct: 0, explanation: "\\(|15| = 15\\) dan \\(|-5| = 5\\). Maka, \\(15 - 5 = 10\\)." },
                { question: "Nilai dari \\(5 \\times |-8|\\) adalah...", options: [{ text: "40" }, { text: "-40" }, { text: "13" }], correct: 0, explanation: "\\(|-8| = 8\\). Maka, \\(5 \\times 8 = 40\\)." },
                { question: "Nilai dari \\(|-18| \\div |3|\\) adalah...", options: [{ text: "6" }, { text: "-6" }, { text: "21" }], correct: 0, explanation: "\\(|-18| = 18\\) dan \\(|3| = 3\\). Maka, \\(18 \\div 3 = 6\\)." },
                { question: "Nilai dari \\(-|-9|\\) adalah...", options: [{ text: "-9" }, { text: "9" }, { text: "0" }], correct: 0, explanation: "Nilai dari \\(|-9|\\) adalah 9. Tanda negatif di luar membuatnya menjadi -9." },
                { question: "Himpunan penyelesaian dari \\(|y| = 1\\) adalah...", options: [{ text: "\\(\\{1, -1\\}\\)" }, { text: "\\(\\{1\\}\\)" }, { text: "\\(\\{0\\}\\)" }], correct: 0, explanation: "Angka yang berjarak 1 dari 0 adalah 1 dan -1." },
                { question: "Himpunan penyelesaian dari \\(|a| = 20\\) adalah...", options: [{ text: "\\(\\{20, -20\\}\\)" }, { text: "\\(\\{20\\}\\)" }, { text: "\\(\\{-20\\}\\)" }], correct: 0, explanation: "Angka yang berjarak 20 dari 0 adalah 20 dan -20." },
                { question: "Himpunan penyelesaian dari \\(|p| = 0\\) adalah...", options: [{ text: "\\(\\{0\\}\\)" }, { text: "\\(\\{0, -0\\}\\)" }, { text: "Himpunan kosong" }], correct: 0, explanation: "Hanya angka 0 yang berjarak 0 dari dirinya sendiri." },
                { question: "Himpunan penyelesaian dari \\(|k| = -3\\) adalah...", options: [{ text: "Himpunan kosong" }, { text: "\\(\\{3\\}\\)" }, { text: "\\(\\{-3\\}\\)" }], correct: 0, explanation: "Nilai mutlak tidak pernah negatif. Tidak ada solusi yang memenuhi." },
                { question: "Jika \\(|m+1|=0\\), maka nilai \\(m\\) adalah...", options: [{ text: "-1" }, { text: "1" }, { text: "0" }], correct: 0, explanation: "Agar nilai mutlaknya 0, ekspresi di dalamnya harus 0. Jadi, \\(m+1=0 \implies m=-1\\)." },
                { question: "Jika \\(x=5\\) dan \\(y=2\\), nilai dari \\(|x-y|\\) adalah...", options: [{ text: "3" }, { text: "-3" }, { text: "7" }], correct: 0, explanation: "Substitusi nilai: \\(|5-2| = |3| = 3\\)." },
                { question: "Jika \\(a=3\\) dan \\(b=10\\), nilai dari \\(|a-b|\\) adalah...", options: [{ text: "7" }, { text: "-7" }, { text: "13" }], correct: 0, explanation: "Substitusi nilai: \\(|3-10| = |-7| = 7\\)." },
                { question: "Jika \\(p=-4\\) dan \\(q=6\\), nilai dari \\(|p+q|\\) adalah...", options: [{ text: "2" }, { text: "10" }, { text: "-10" }], correct: 0, explanation: "Substitusi nilai: \\(|-4+6| = |2| = 2\\)." },
                { question: "Jika \\(k=-2\\) dan \\(l=-5\\), nilai dari \\(|k-l|\\) adalah...", options: [{ text: "3" }, { text: "-7" }, { text: "7" }], correct: 0, explanation: "Substitusi nilai: \\(|-2 - (-5)| = |-2+5| = |3| = 3\\)." },
                { question: "Jika \\(x=2\\), nilai dari \\(|x^2 - 3x|\\) adalah...", options: [{ text: "2" }, { text: "-2" }, { text: "10" }], correct: 0, explanation: "Substitusi nilai: \\(|(2)^2 - 3(2)| = |4 - 6| = |-2| = 2\\)." }
            ],
            MOTS: [
                { question: "HP dari \\(|x - 8| = 3\\) adalah...", options: [{ text: "\\(\\{11, 5\\}\\)" }, { text: "\\(\\{11, -5\\}\\)" }, { text: "\\(\\{-11, 5\\}\\)" }], correct: 0, explanation: "Kasus 1: \\(x-8=3 \implies x=11\\). Kasus 2: \\(x-8=-3 \implies x=5\\)." },
                { question: "HP dari \\(|2x + 1| = 13\\) adalah...", options: [{ text: "\\(\\{6, -7\\}\\)" }, { text: "\\(\\{6, 7\\}\\)" }, { text: "\\(\\{-6, 7\\}\\)" }], correct: 0, explanation: "Kasus 1: \\(2x+1=13 \implies 2x=12 \implies x=6\\). Kasus 2: \\(2x+1=-13 \implies 2x=-14 \implies x=-7\\)." },
                { question: "HP dari \\(|5 - x| = 2\\) adalah...", options: [{ text: "\\(\\{3, 7\\}\\)" }, { text: "\\(\\{-3, -7\\}\\)" }, { text: "\\(\\{-3, 7\\}\\)" }], correct: 0, explanation: "Kasus 1: \\(5-x=2 \implies x=3\\). Kasus 2: \\(5-x=-2 \implies x=7\\)." },
                { question: "Jika \\(3|x-1|=15\\), maka nilai \\(x\\) adalah...", options: [{ text: "\\(\\{6, -4\\}\\)" }, { text: "\\(\\{6, 4\\}\\)" }, { text: "\\(\\{-6, -4\\}\\)" }], correct: 0, explanation: "Bagi kedua ruas dengan 3: \\(|x-1|=5\\). Kasus 1: \\(x-1=5 \implies x=6\\). Kasus 2: \\(x-1=-5 \implies x=-4\\)." },
                { question: "HP dari \\(|(x/3) - 2| = 4\\) adalah...", options: [{ text: "\\(\\{18, -6\\}\\)" }, { text: "\\(\\{6, -18\\}\\)" }, { text: "\\(\\{6, -6\\}\\)" }], correct: 0, explanation: "Kasus 1: \\(x/3 - 2=4 \implies x/3=6 \implies x=18\\). Kasus 2: \\(x/3 - 2=-4 \implies x/3=-2 \implies x=-6\\)." },
                { question: "Penyelesaian dari \\(|x-5| < 2\\) adalah...", options: [{ text: "\\(3 < x < 7\\)" }, { text: "\\(-3 < x < 7\\)" }, { text: "\\(x<3\\) atau \\(x>7\\)" }], correct: 0, explanation: "\\(-2 < x-5 < 2\\). Tambah 5 ke semua ruas: \\(3 < x < 7\\)." },
                { question: "Penyelesaian dari \\(|3x+2| \le 8\\) adalah...", options: [{ text: "\\(-10/3 \le x \le 2\\)" }, { text: "\\(-2 \le x \le 10/3\\)" }, { text: "\\(x \le -10/3\\)" }], correct: 0, explanation: "\\(-8 \le 3x+2 \le 8\\). Kurangi 2: \\(-10 \le 3x \le 6\\). Bagi 3: \\(-10/3 \le x \le 2\\)." },
                { question: "Penyelesaian dari \\(|-2x+3| < 7\\) adalah...", options: [{ text: "\\(-2 < x < 5\\)" }, { text: "\\(-5 < x < 2\\)" }, { text: "\\(x < -2\\) atau \\(x>5\\)" }], correct: 0, explanation: "\\(-7 < -2x+3 < 7\\). Kurangi 3: \\(-10 < -2x < 4\\). Bagi -2 (balik tanda): \\(5 > x > -2\\) atau \\(-2 < x < 5\\)." },
                { question: "HP dari \\(|x+1| < -1\\) adalah...", options: [{ text: "Himpunan kosong" }, { text: "\\(x < -2\\)" }, { text: "Semua bilangan real" }], correct: 0, explanation: "Nilai mutlak selalu non-negatif, sehingga tidak mungkin lebih kecil dari bilangan negatif." },
                { question: "Penyelesaian dari \\(2|x-3| \le 10\\) adalah...", options: [{ text: "\\(-2 \le x \le 8\\)" }, { text: "\\(-8 \le x \le 2\\)" }, { text: "\\(x \le -2\\) atau \\(x \ge 8\\)" }], correct: 0, explanation: "Bagi 2: \\(|x-3| \le 5\\). Maka \\(-5 \le x-3 \le 5\\). Tambah 3: \\(-2 \le x \le 8\\)." },
                { question: "Penyelesaian dari \\(|x-2| > 5\\) adalah...", options: [{ text: "\\(x < -3\\) atau \\(x > 7\\)" }, { text: "\\(-3 < x < 7\\)" }, { text: "\\(x > 7\\)" }], correct: 0, explanation: "Kasus 1: \\(x-2 > 5 \implies x > 7\\). Kasus 2: \\(x-2 < -5 \implies x < -3\\)." },
                { question: "Penyelesaian dari \\(|2x-3| \ge 7\\) adalah...", options: [{ text: "\\(x \le -2\\) atau \\(x \ge 5\\)" }, { text: "\\(-2 \le x \le 5\\)" }, { text: "\\(x \ge 5\\)" }], correct: 0, explanation: "Kasus 1: \\(2x-3 \ge 7 \implies 2x \ge 10 \implies x \ge 5\\). Kasus 2: \\(2x-3 \le -7 \implies 2x \le -4 \implies x \le -2\\)." },
                { question: "Penyelesaian dari \\(|4-x| > 1\\) adalah...", options: [{ text: "\\(x < 3\\) atau \\(x > 5\\)" }, { text: "\\(3 < x < 5\\)" }, { text: "\\(x < 5\\)" }], correct: 0, explanation: "Kasus 1: \\(4-x > 1 \implies 3 > x \implies x < 3\\). Kasus 2: \\(4-x < -1 \implies 5 < x \implies x > 5\\)." },
                { question: "Penyelesaian dari \\(|x| \ge -4\\) adalah...", options: [{ text: "Semua bilangan real" }, { text: "\\(x \ge -4\\)" }, { text: "Himpunan kosong" }], correct: 0, explanation: "Nilai mutlak selalu non-negatif (lebih besar atau sama dengan 0), sehingga pasti lebih besar dari bilangan negatif manapun." },
                { question: "HP dari \\(3|x+2| > 12\\) adalah...", options: [{ text: "\\(x < -6\\) atau \\(x > 2\\)" }, { text: "\\(-6 < x < 2\\)" }, { text: "\\(x > 2\\)" }], correct: 0, explanation: "Bagi 3: \\(|x+2| > 4\\). Kasus 1: \\(x+2 > 4 \implies x > 2\\). Kasus 2: \\(x+2 < -4 \implies x < -6\\)." },
                { question: "HP dari \\(|x+4| = |x-6|\\) adalah...", options: [{ text: "\\(\\{1\\}\\)" }, { text: "\\(\\{1, -10\\}\\)" }, { text: "Himpunan kosong" }], correct: 0, explanation: "Kuadratkan: \\((x+4)^2 = (x-6)^2 \implies x^2+8x+16=x^2-12x+36 \implies 20x=20 \implies x=1\\)." },
                { question: "HP dari \\(|2x+1| = |x-5|\\) adalah...", options: [{ text: "\\(\\{4/3, -6\\}\\)" }, { text: "\\(\\{-4/3, 6\\}\\)" }, { text: "\\(\\{4/3, 6\\}\\)" }], correct: 0, explanation: "\\((2x+1)^2=(x-5)^2 \implies (2x+1-x+5)(2x+1+x-5)=0 \implies (x+6)(3x-4)=0\\). Solusi \\(x=-6\\) atau \\(x=4/3\\)." },
                { question: "HP dari \\(|3x| = |x+8|\\) adalah...", options: [{ text: "\\(\\{4, -2\\}\\)" }, { text: "\\(\\{4, 2\\}\\)" }, { text: "\\(\\{-4, -2\\}\\)" }], correct: 0, explanation: "\\((3x)^2=(x+8)^2 \implies (3x-x-8)(3x+x+8)=0 \implies (2x-8)(4x+8)=0\\). Solusi \\(x=4\\) atau \\(x=-2\\)." },
                { question: "HP dari \\(|x+2| = |-x-2|\\) adalah...", options: [{ text: "Semua bilangan real" }, { text: "\\(x=-2\\)" }, { text: "Himpunan kosong" }], correct: 0, explanation: "Karena \\(|a| = |-a|\\) dan \\(-(x+2) = -x-2\\), maka ini adalah identitas yang benar untuk semua x." },
                { question: "HP dari \\(|x-3| = |5-x|\\) adalah...", options: [{ text: "\\(\\{4\\}\\)" }, { text: "Semua bilangan real" }, { text: "Himpunan kosong" }], correct: 0, explanation: "\\((x-3)^2=(5-x)^2 \implies x^2-6x+9=25-10x+x^2 \implies 4x=16 \implies x=4\\)." },
                { question: "Bentuk \\(|x-2|\\) dapat ditulis sebagai...", options: [{ text: "\\(\\sqrt{(x-2)^2}\\)" }, { text: "\\((x-2)^2\\)" }, { text: "\\(x-2\\)" }], correct: 0, explanation: "Salah satu sifat dasar nilai mutlak adalah \\(|a| = \sqrt{a^2}\\). Ini selalu menghasilkan nilai non-negatif." },
                { question: "Nilai \\(x\\) yang memenuhi \\(-2|x+1| = -10\\) adalah...", options: [{ text: "\\(\\{4, -6\\}\\)" }, { text: "\\(\\{4, 6\\}\\)" }, { text: "\\(\\{-4, 6\\}\\)" }], correct: 0, explanation: "Bagi -2: \\(|x+1|=5\\). Kasus 1: \\(x+1=5 \implies x=4\\). Kasus 2: \\(x+1=-5 \implies x=-6\\)." },
                { question: "Jika \\(|2x-k|=5\\) memiliki salah satu solusi \\(x=4\\), maka nilai \\(k\\) adalah...", options: [{ text: "3" }, { text: "5" }, { text: "8" }], correct: 0, explanation: "Substitusi \\(x=4\\): \\(|2(4)-k|=5 \implies |8-k|=5\\). Kasus 1: \\(8-k=5 \implies k=3\\). Kasus 2: \\(8-k=-5 \implies k=13\\). Opsi yang tersedia adalah 3." },
                { question: "Penyelesaian dari \\(5-|x-1| = 2\\) adalah...", options: [{ text: "\\(\\{4, -2\\}\\)" }, { text: "\\(\\{-4, 2\\}\\)" }, { text: "\\(\\{4, 2\\}\\)" }], correct: 0, explanation: "\\(5-2 = |x-1| \implies |x-1|=3\\). Kasus 1: \\(x-1=3 \implies x=4\\). Kasus 2: \\(x-1=-3 \implies x=-2\\)." },
                { question: "Suhu normal tubuh manusia 37°C dengan toleransi 0.5°C. Model matematikanya adalah...", options: [{ text: "\\(|T-37| \le 0.5\\)" }, { text: "\\(|T-37| \ge 0.5\\)" }, { text: "\\(|T-0.5| \le 37\\)" }], correct: 0, explanation: "Toleransi berarti selisih (jarak) antara suhu terukur (T) dan suhu normal (37) tidak boleh lebih dari 0.5, yang ditulis \\(|T-37| \le 0.5\\)." }
            ],
            HOTS: [
                { question: "Penyelesaian dari \\(|x+1| < |x-3|\\) adalah...", options: [{ text: "\\(x < 1\\)" }, { text: "\\(x > 1\\)" }, { text: "\\(x < -1\\)" }], correct: 0, explanation: "Kuadratkan kedua ruas: \\((x+1)^2 < (x-3)^2 \implies x^2+2x+1 < x^2-6x+9 \implies 8x < 8 \implies x < 1\\)." },
                { question: "HP dari \\(|x-3|^2 - 5|x-3| + 6 = 0\\) adalah...", options: [{ text: "\\(\\{0, 1, 5, 6\\}\\)" }, { text: "\\(\\{1, 5\\}\\)" }, { text: "\\(\\{0, 6\\}\\)" }], correct: 0, explanation: "Misal \\(p=|x-3|\\). \\(p^2-5p+6=0 \implies (p-2)(p-3)=0\\). Jadi \\(p=2\\) atau \\(p=3\\). Kasus 1: \\(|x-3|=2 \implies x=5, x=1\\). Kasus 2: \\(|x-3|=3 \implies x=6, x=0\\)." },
                { question: "Penyelesaian dari \\( |2x+5| \ge x+1 \\) adalah...", options: [{ text: "\\(x \le -4\\) atau \\(x \ge -2\\)" }, { text: "\\(-4 \le x \le -2\\)" }, { text: "Semua bilangan real" }], correct: 0, explanation: "Kuadratkan kedua ruas (syarat \\(x+1 \ge 0\\) atau uji kasus). \\((2x+5)^2 \ge (x+1)^2 \implies (x+4)(3x+6) \ge 0\\). Pembuat nol \\(x=-4, x=-2\\). Solusi: \\(x \le -4\\) atau \\(x \ge -2\\)." },
                { question: "Semua nilai \\(x\\) yang memenuhi \\( 0 < |x-3| \le 3 \\) adalah...", options: [{ text: "\\([0, 3) \cup (3, 6]\\)" }, { text: "\\((0, 6]\\)" }, { text: "\\([0, 6]\\)" }], correct: 0, explanation: "Pertidaksamaan ini berarti \\(|x-3| > 0\\) DAN \\(|x-3| \le 3\\). Yang pertama berarti \\(x \ne 3\\). Yang kedua berarti \\(-3 \le x-3 \le 3 \implies 0 \le x \le 6\\). Gabungan keduanya adalah himpunan \\([0, 6]\\) kecuali angka 3." },
                { question: "Solusi dari \\( |x-1|+|x|+|x+1|=6 \\) adalah...", options: [{ text: "\\(\\{2, -2\\}\\)" }, { text: "\\(\\{2\\}\\)" }, { text: "\\(\\{-2\\}\\)" }], correct: 0, explanation: "Uji interval. Jika \\(x \ge 1\\), \\((x-1)+x+(x+1)=6 \implies 3x=6 \implies x=2\\) (memenuhi). Jika \\(x \le -1\\), \\(-(x-1)-x-(x+1)=6 \implies -3x=6 \implies x=-2\\) (memenuhi)." },
                { question: "HP dari \\( ||x|-5| < 3 \\) adalah...", options: [{ text: "\\((-8, -2) \cup (2, 8)\\)" }, { text: "\\((-8, 8)\\)" }, { text: "\\((2, 8)\\)" }], correct: 0, explanation: "\\(-3 < |x|-5 < 3 \implies 2 < |x| < 8\\). Ini berarti \\(|x|>2\\) DAN \\(|x|<8\\). Solusinya \\((x<-2 \text{ atau } x>2)\\) DAN \\(-8<x<8\\). Irisannya adalah \\((-8, -2) \cup (2, 8)\\)." },
                { question: "Jika \\( |x| + |y| = 4 \\), maka nilai maksimum dari \\(x-y\\) adalah...", options: [{ text: "4" }, { text: "8" }, { text: "0" }], correct: 0, explanation: "Persamaan \\(|x| + |y| = 4\\) membentuk belah ketupat dengan titik sudut (4,0), (0,4), (-4,0), (0,-4). Nilai \\(x-y\\) maksimum terjadi di salah satu titik sudut. Cek (4,0) -> 4. Cek (0,-4) -> 4. Cek (-4,0) -> -4. Cek (0,4) -> -4. Maksimumnya 4." },
                { question: "HP dari \\( ||x-1|-4| = 2 \\) adalah...", options: [{ text: "\\(\\{-5, -1, 3, 7\\}\\)" }, { text: "\\(\\{-1, 3\\}\\)" }, { text: "\\(\\{-5, 7\\}\\)" }], correct: 0, explanation: "Luar: \\(|x-1|-4=2\\) atau \\(|x-1|-4=-2\\). Jadi \\(|x-1|=6\\) atau \\(|x-1|=2\\). Dari \\(|x-1|=6 \implies x=7, x=-5\\). Dari \\(|x-1|=2 \implies x=3, x=-1\\)." },
                { question: "HP dari \\( |x-2|+|x+3| = 5 \\) adalah...", options: [{ text: "\\([-3, 2]\\)" }, { text: "\\(\\{-3, 2\\}\\)" }, { text: "Semua bilangan real" }], correct: 0, explanation: "Jarak dari x ke 2 ditambah jarak dari x ke -3 sama dengan 5. Jarak antara -3 dan 2 adalah 5. Ini hanya terjadi jika x berada di antara -3 dan 2 (inklusif)." },
                { question: "HP dari \\( |x|+|x-4| = 2 \\) adalah...", options: [{ text: "Himpunan kosong" }, { text: "\\(\\{1, 3\\}\\)" }, { text: "\\(1 \le x \le 3\\)" }], correct: 0, explanation: "Jarak dari x ke 0 ditambah jarak dari x ke 4 adalah 2. Jarak minimum antara 0 dan 4 adalah 4. Tidak mungkin jumlah jaraknya lebih kecil dari jarak minimum tersebut." },
                { question: "Penyelesaian dari \\( |x-1|^2 < 2|x-1| + 3 \\) adalah...", options: [{ text: "\\(-2 < x < 4\\)" }, { text: "\\(-4 < x < 2\\)" }, { text: "\\(x<-2\\) atau \\(x>4\\)" }], correct: 0, explanation: "Misal \\(p=|x-1|\\). \\(p^2-2p-3<0 \implies (p-3)(p+1)<0\\). Solusi: \\(-1<p<3\\). Karena \\(p=|x-1| \ge 0\\), maka \\(0 \le |x-1| < 3\\). Ini berarti \\(-3 < x-1 < 3\\), sehingga \\(-2 < x < 4\\)." },
                { question: "Nilai \\(x\\) yang memenuhi \\(|x^2 - x - 1| = 1\\) adalah...", options: [{ text: "\\(\\{-1, 0, 1, 2\\}\\)" }, { text: "\\(\\{0, 1\\}\\)" }, { text: "\\(\\{1, 2\\}\\)" }], correct: 0, explanation: "Kasus 1: \\(x^2-x-1=1 \implies x^2-x-2=0 \implies (x-2)(x+1)=0 \implies x=2, x=-1\\). Kasus 2: \\(x^2-x-1=-1 \implies x^2-x=0 \implies x(x-1)=0 \implies x=0, x=1\\)." },
                { question: "HP dari \\( \sqrt{x^2-6x+9} = 5 \\) adalah...", options: [{ text: "\\(\\{8, -2\\}\\)" }, { text: "\\(\\{8\\}\\)" }, { text: "\\(\\{-2\\}\\)" }], correct: 0, explanation: "Bentuk akar kuadrat dari kuadrat sempurna adalah nilai mutlak: \\(\sqrt{(x-3)^2} = |x-3|\\). Maka \\(|x-3|=5\\). Solusinya \\(x-3=5 \implies x=8\\) dan \\(x-3=-5 \implies x=-2\\)." },
                { question: "Jika \\(|x|<3\\) dan \\(|y|<5\\), maka nilai \\(|x-y|\\) pasti...", options: [{ text: "Kurang dari 8" }, { text: "Kurang dari 2" }, { text: "Lebih dari 2" }], correct: 0, explanation: "Gunakan sifat pertidaksamaan segitiga: \\(|x-y| \le |x|+|-y| = |x|+|y|\\). Maka \\(|x-y| < 3+5=8\\)." },
                { question: "Agar persamaan \\(|x-3|=k-1\\) memiliki tepat dua solusi, syarat untuk \\(k\\) adalah...", options: [{ text: "\\(k > 1\\)" }, { text: "\\(k = 1\\)" }, { text: "\\(k < 1\\)" }], correct: 0, explanation: "Persamaan \\(|A|=C\\) punya dua solusi jika \\(C>0\\). Maka \\(k-1>0 \implies k>1\\)." },
                { question: "Grafik fungsi \\(f(x) = |x-2|+3\\) memiliki titik puncak (minimum) di...", options: [{ text: "\\((2, 3)\\)" }, { text: "\\((-2, 3)\\)" }, { text: "\\((2, -3)\\)" }], correct: 0, explanation: "Bentuk \\(y=|x-h|+k\\) memiliki puncak di \\((h,k)\\). Di sini, \\(h=2\\) dan \\(k=3\\)." },
                { question: "Banyaknya bilangan bulat yang menjadi solusi dari \\(|2x+1| \le 5\\) adalah...", options: [{ text: "6" }, { text: "5" }, { text: "7" }], correct: 0, explanation: "\\(-5 \le 2x+1 \le 5 \implies -6 \le 2x \le 4 \implies -3 \le x \le 2\\). Bilangan bulatnya adalah -3, -2, -1, 0, 1, 2. Total ada 6 bilangan." },
                { question: "Jika \\(f(x)=|x|\\) dan \\(g(x)=x^2-2\\), maka \\(f(g(-1))\\) adalah...", options: [{ text: "1" }, { text: "-1" }, { text: "3" }], correct: 0, explanation: "Hitung dari dalam: \\(g(-1)=(-1)^2-2 = 1-2 = -1\\). Lalu \\(f(g(-1)) = f(-1) = |-1| = 1\\)." },
                { question: "HP dari \\(|x^2-8| = 1\\) adalah...", options: [{ text: "\\(\\{\pm 3, \pm \sqrt{7}\\}\\)" }, { text: "\\(\\{\pm 3\\}\\)" }, { text: "\\(\\{\pm \sqrt{7}\\}\\)" }], correct: 0, explanation: "Kasus 1: \\(x^2-8=1 \implies x^2=9 \implies x=\pm 3\\). Kasus 2: \\(x^2-8=-1 \implies x^2=7 \implies x=\pm \sqrt{7}\\)." },
                { question: "Jika \\( |x| > |y| \\), manakah pernyataan yang PASTI benar?", options: [{ text: "\\(x^2 > y^2\\)" }, { text: "\\(x > y\\)" }, { text: "\\(x > -y\\)" }], correct: 0, explanation: "Jika \\(|x|>|y|\\) dan keduanya non-negatif, maka mengkuadratkan kedua sisi akan mempertahankan tanda pertidaksamaan. \\(x>y\\) belum tentu benar, contoh \\(x=-5, y=3\\)." },
                { question: "Solusi dari \\( |x-1|+|x|+|x+1|=3 \\) adalah...", options: [{ text: "\\(\\{1, -1\\}\\)" }, { text: "\\(\\{1\\}\\)" }, { text: "\\( [-1, 1] \\)" }], correct: 0, explanation: "Uji interval. Jika \\(x=1\\), \\(0+1+2=3\\) benar. Jika \\(x=-1\\), \\(2+1+0=3\\) benar. Jika \\(x=0\\), \\(1+0+1=2\\) salah. Jadi hanya \\(x=1\\) dan \\(x=-1\\) yang memenuhi." },
                { question: "Penyelesaian dari \\( |x^2-2x-8| > 7 \\) adalah...", options: [{ text: "\\(x<-3\\) atau \\(x>5\\) atau \\(1-\sqrt{2} < x < 1+\sqrt{2}\\)" }, { text: "\\(x<-3\\) atau \\(x>5\\)" }, { text: "\\(x>5\\)" }], correct: 0, explanation: "Kasus 1: \\(x^2-2x-8 > 7 \implies x^2-2x-15>0 \implies (x-5)(x+3)>0\\). Solusi: \\(x<-3\\) atau \\(x>5\\). Kasus 2: \\(x^2-2x-8 < -7 \implies x^2-2x-1<0\\). Akarnya \\(1 \pm \sqrt{2}\\). Solusi: \\(1-\sqrt{2} < x < 1+\sqrt{2}\\)." },
                { question: "Nilai minimum dari fungsi \\(f(x)=|x-5|+|x+2|\\) adalah...", options: [{ text: "7" }, { text: "5" }, { text: "2" }], correct: 0, explanation: "Ini adalah jumlah jarak dari x ke 5 dan -2. Nilai minimum terjadi ketika x berada di antara -2 dan 5. Jarak minimumnya adalah jarak antara -2 dan 5 itu sendiri, yaitu \\(|5 - (-2)| = 7\\)." },
                { question: "Agar \\(|x^2-4|=k\\) punya 3 solusi, nilai \\(k\\) adalah...", options: [{ text: "4" }, { text: "0" }, { text: "3" }], correct: 0, explanation: "Grafik \\(y=|x^2-4|\\) adalah parabola \\(y=x^2-4\\) dengan bagian negatifnya dicerminkan ke atas sumbu x. Puncak cerminan ada di y=4. Garis horizontal \\(y=k\\) akan memotong 3 kali hanya jika ia tepat melewati puncak cerminan tersebut, yaitu saat \\(k=4\\)." },
                { question: "HP dari \\( |x-1| < 3\\) dan \\(|x-4| > 2 \\) adalah...", options: [{ text: "\\((-2, 2)\\)" }, { text: "\\((2, 4)\\)" }, { text: "\\((4, 6)\\)" }], correct: 0, explanation: "Solusi 1: \\(-3<x-1<3 \implies -2<x<4\\). Solusi 2: \\(x-4>2 \implies x>6\\) atau \\(x-4<-2 \implies x<2\\). Irisan dari \\((-2,4)\\) dan \\((-\infty, 2) \cup (6, \infty)\\) adalah \\((-2,2)\\)." }
            ]
        };

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function showNotification(message, type = 'warning') {
            const container = document.getElementById('notification-container');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            let icon = '⚠️';
            if (type === 'success') icon = '✅';
            if (type === 'info') icon = 'ℹ️';
            notif.innerHTML = `<span>${icon}</span> <span>${message}</span>`;
            container.appendChild(notif);
            setTimeout(() => { notif.remove(); }, 4000);
        }

        function updateProgress() {
            const stages = ['step0', 'step1', 'step2', 'step3', 'step4'];
            const progress = (state.currentStage / 4) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            stages.forEach((id, idx) => {
                const step = document.getElementById(id);
                step.classList.remove('active', 'completed');
                if (idx < state.currentStage) step.classList.add('completed');
                else if (idx === state.currentStage) step.classList.add('active');
            });
            const levelNames = ['Materi', 'LOTS', 'MOTS', 'HOTS', 'Selesai'];
            document.getElementById('currentLevel').textContent = levelNames[state.currentStage];
        }
        
        function showMaterial() {
            document.getElementById('contentArea').innerHTML = quizContent.material + `<div class="button-group"><button class="btn btn-primary" onclick="startLOTS()">Mulai Level LOTS →</button></div>`;
            state.currentStage = 0;
            updateProgress();
            setTimeout(() => MathJax.typesetPromise(), 10);
        }
        
        function startQuiz(level) {
            state.currentQuiz = level;
            const fullBank = quizContent[level];
            const shuffledBank = shuffleArray([...fullBank]);
            state.activeQuestions = shuffledBank.slice(0, 5);

            state.userAnswers = Array(state.activeQuestions.length).fill(null);
            const levelMap = { LOTS: 1, MOTS: 2, HOTS: 3 };
            state.currentStage = levelMap[level];
            updateProgress(); updateStats();
            const content = `<div class="quiz-section active">
                    <h2 style="text-align:center; margin-bottom: 20px;">📝 ${level} - Mode Ujian (5 Soal Acak)</h2>
                    <div class="attempts-info"><strong>Percobaan ${6 - state.attempts[level]} dari 5</strong> | Sudah lulus: ${state.passCount[level]}/2 kali | Gagal berturut-turut: ${state.consecutiveFails[level]}/3</div>
                    <div id="questionsContainer"></div>
                    <div class="button-group" id="quiz-button-group"><button id="submitBtn" class="btn btn-primary" onclick="submitQuiz()">Submit Jawaban</button></div>
                </div>`;
            document.getElementById('contentArea').innerHTML = content;
            renderQuestions(state.activeQuestions);
        }
        
        function renderQuestions(questions) {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = questions.map((q, idx) => {
                const optionsHTML = q.options.map((opt, optIdx) => 
                    `<div class="option" onclick="selectOption(this, ${idx}, ${optIdx})">
                        <input type="radio" name="q${idx}" id="q${idx}opt${optIdx}" style="pointer-events: none;">
                        <label for="q${idx}opt${optIdx}" style="cursor: pointer; width: 100%;">${opt.text}</label>
                    </div>`
                ).join('');

                return `<div class="question-card" id="question${idx}">
                    <div class="question-number">Soal ${idx + 1} dari ${questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options" style="display:flex; flex-direction:column; gap:10px;">${optionsHTML}</div>
                    <div class="explanation hidden" id="explanation${idx}"></div>
                </div>`;
            }).join('');
            setTimeout(() => MathJax.typesetPromise(), 10);
        }
        
        function selectOption(element, questionIdx, optionIdx) {
            if (document.getElementById('submitBtn')?.disabled) { return; }
            const options = document.querySelectorAll(`#question${questionIdx} .option`);
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            element.querySelector('input[type="radio"]').checked = true;
            state.userAnswers[questionIdx] = optionIdx;
        }
        
        function submitQuiz() {
            const level = state.currentQuiz;
            const questions = state.activeQuestions;
            const unanswered = state.userAnswers.filter(ans => ans === null).length;

            if (unanswered > 0) {
                showNotification(`Mohon jawab semua soal! Ada ${unanswered} soal yang belum terjawab.`);
                return;
            }

            let correct = 0;
            questions.forEach((q, idx) => {
                const userAnswerIdx = state.userAnswers[idx];
                const isCorrect = (userAnswerIdx === q.correct);
                if (isCorrect) correct++;
                const options = document.querySelectorAll(`#question${idx} .option`);
                options[userAnswerIdx].classList.add(isCorrect ? 'correct' : 'incorrect');
                if (!isCorrect) { options[q.correct].classList.add('correct'); }
                const explanation = document.getElementById(`explanation${idx}`);
                explanation.innerHTML = `<strong>💡 Pembahasan:</strong> ${q.explanation}`;
                explanation.classList.remove('hidden');
            });
            setTimeout(() => MathJax.typesetPromise(), 10);
            
            const score = (correct / questions.length) * 100;
            const passed = score >= 80;
            state.attempts[level]--;
            if (passed) {
                state.passCount[level]++; state.consecutiveFails[level] = 0;
                showNotification(`Luar biasa! Skor Anda ${score.toFixed(0)}%.`, 'success');
            } else {
                state.consecutiveFails[level]++;
                showNotification(`Skor Anda ${score.toFixed(0)}%. Terus coba lagi!`, 'warning');
            }
            updateStats();
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('quiz-button-group').innerHTML = `<button class="btn btn-primary" onclick='showResult("${level}", ${score}, ${passed})'>Lihat Ringkasan Hasil →</button>`;
        }
        
        function showResult(level, score, passed) {
            const canProceed = state.passCount[level] >= 2;
            const isEliminated = state.consecutiveFails[level] >= 3 || (state.attempts[level] === 0 && !canProceed);
            let resultHTML = `
                <div class="result-summary" style="text-align: center;">
                    <h2>${passed ? '✅ Lulus!' : '❌ Belum Lulus'} (Skor Minimal: 80%)</h2>
                    <div style="font-size: 4em; font-weight: bold; color: ${passed ? 'var(--accent-green)' : 'var(--accent-red)'}; margin: 20px 0;">${score.toFixed(0)}%</div>
                    <p style="font-size: 1.2em; margin: 20px 0;">Kamu menjawab benar ${Math.round((score / 100) * state.activeQuestions.length)} dari ${state.activeQuestions.length} soal</p>
                    <div class="attempts-info"><strong>Status:</strong><br>Lulus: ${state.passCount[level]}/2 kali | Percobaan tersisa: ${state.attempts[level]} | Gagal berturut-turut: ${state.consecutiveFails[level]}/3</div>`;
            if (isEliminated) {
                resultHTML += `<div style="background: rgba(220, 53, 69, 0.2); padding: 20px; border-radius: 10px; margin: 20px 0;"><h3 style="color: var(--accent-red);">❌ Mode Kilat - GUGUR</h3><p style="margin: 15px 0;">Kamu telah ${state.consecutiveFails[level] >= 3 ? 'gagal 3x berturut-turut' : 'kehabisan percobaan'}.</p></div><div class="button-group"><button class="btn btn-secondary" onclick="resetSystem()">Mulai Ulang dari Awal</button></div>`;
            } else if (canProceed) {
                const nextLevel = level === 'LOTS' ? 'MOTS' : (level === 'MOTS' ? 'HOTS' : null);
                if (nextLevel) {
                    resultHTML += `<div style="background: rgba(40, 167, 69, 0.2); padding: 20px; border-radius: 10px; margin: 20px 0;"><h3 style="color: var(--accent-green);">🔓 Level ${nextLevel} Terbuka!</h3><p style="margin: 15px 0;">Siap untuk tantangan berikutnya?</p></div><div class="button-group"><button class="btn" onclick="showMaterial()">Baca Materi Lagi</button><button class="btn btn-primary" onclick="start${nextLevel}()">Lanjut ke ${nextLevel} →</button></div>`;
                } else { resultHTML += generateCertificate(); }
            } else {
                resultHTML += `<div class="button-group"><button class="btn" onclick="showMaterial()">Baca Materi Lagi</button><button class="btn btn-primary" onclick="start${level}()">Coba Lagi (${state.attempts[level]} percobaan)</button></div>`;
            }
            resultHTML += `</div>`; document.getElementById('contentArea').innerHTML = resultHTML;
        }

        function generateCertificate() {
            state.currentStage = 4; updateProgress();
            return `<div class="certificate"><div style="font-size: 5em;">🏆</div><h2 style="font-size: 2.5em; margin-bottom: 20px; color: var(--accent-teal);">Sertifikat Kelulusan Topik</h2><p style="font-size: 1.3em; margin: 20px 0;">SELAMAT!</p><p style="font-size: 1.1em; line-height: 1.6;">Kamu telah berhasil menyelesaikan topik <strong>Nilai Mutlak</strong> dengan melewati semua level: LOTS ✓ MOTS ✓ HOTS ✓</p></div><div class="button-group"><button class="btn btn-primary" onclick="resetSystem()">Mulai Topik Baru</button></div>`;
        }
        
        function updateStats() {
            const level = state.currentQuiz || 'LOTS';
            document.getElementById('attemptsLeft').textContent = state.attempts[level];
            document.getElementById('passCount').textContent = `${state.passCount[level]}/2`;
        }
        
        function startLOTS() { startQuiz('LOTS'); }
        function startMOTS() { startQuiz('MOTS'); }
        function startHOTS() { startQuiz('HOTS'); }
        
        function resetSystem() {
            Object.assign(state, {
                currentStage: 0, attempts: { LOTS: 5, MOTS: 5, HOTS: 5 }, passCount: { LOTS: 0, MOTS: 0, HOTS: 0 },
                consecutiveFails: { LOTS: 0, MOTS: 0, HOTS: 0 }, currentQuiz: null, userAnswers: [], activeQuestions: []
            });
            showNotification('Sistem telah direset, selamat belajar kembali!', 'info');
            showMaterial();
        }
        
        // Inisialisasi
        showMaterial();
    </script>
</body>
</html>
